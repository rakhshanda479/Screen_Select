<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScreenSelect - Movie Recommendation</title>
  <style>
    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      min-height: 100vh;
      margin: 0;
      font-family: 'Poppins', sans-serif;
      color: #fff;
      padding: 20px;
    }
    h1, h2 { text-align: center; }
    .movie-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .movie-card {
      background: rgba(255,255,255,0.1);
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .movie-card img { width: 100%; height: 300px; object-fit: cover; }
    .movie-info { padding: 10px; }
    .badge { padding: 4px 10px; border-radius: 999px; font-size: 0.8rem; margin-right: 5px; }
    .genre-Action { background:#3498db; }
    .genre-Comedy { background:#f1c40f; color:#000; }
    .genre-Thriller { background:#e74c3c; }
    .genre-Fantasy { background:#9b59b6; }
    .type-Hollywood { background:#9b59b6; }
    .type-Bollywood { background:#2ecc71; }
    .year { background:#34495e; }
    button {
      margin-top: 10px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #fff;
      color: #333;
      font-weight: bold;
    }
    #history, #recommendations, #auth, #feedback { margin-top: 40px; }
    .rating { font-weight: bold; margin-top: 5px; }
    input { padding: 8px; margin: 5px; border-radius: 6px; border: none; }

    /* Auth Page Styling */
    #auth {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
    }
    .auth-card {
      background: rgba(255, 255, 255, 0.15);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 30px rgba(0,0,0,0.4);
      text-align: center;
      width: 320px;
    }
    .auth-card h2 {
      background: linear-gradient(90deg, #ff6a00, #ee0979);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 20px;
    }
    .auth-card input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    .auth-card button {
      width: 48%;
      margin: 5px 1%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: linear-gradient(90deg, #ff6a00, #ee0979);
      color: #fff;
      font-weight: bold;
      transition: transform 0.2s ease;
    }
    .auth-card button:hover {
      transform: scale(1.05);
    }
    #password-error {
      color: #ff4d4d;
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>üé¨ ScreenSelect</h1>

  <section id="auth">
    <div class="auth-card">
      <h2>Login / Signup</h2>
      <div id="auth-forms">
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <div id="password-error">Password must be at least 8 characters and contain letters + numbers.</div>
        <button onclick="signup()">Sign Up</button>
        <button onclick="login()">Login</button>
      </div>
      <div id="welcome" style="display:none;">
        <p>Welcome, <span id="currentUser"></span>!</p>
        <button onclick="logout()">Logout</button>
      </div>
    </div>
  </section>

  <div id="app" style="display:none;">
    <h2>Top Movies</h2>
    <div id="movie-list" class="movie-grid"></div>

    <section id="history">
      <h2>Your History</h2>
      <div id="history-list" class="movie-grid"></div>
    </section>

    <section id="recommendations">
      <h2>Recommended for You</h2>
      <div id="reco-list" class="movie-grid"></div>
    </section>

    <section id="feedback">
      <h2>Feedback</h2>
      <button onclick="sendFeedback('üëç')">üëç</button>
      <button onclick="sendFeedback('üëé')">üëé</button>
    </section>
  </div>

  <script>
    const TMDB_KEY = 'dba0ed84ee8debc1393d157ba5a3bd3c';
    const MOVIES = [
      { title: 'Avengers infinity war', genre: 'Action', type: 'Hollywood', releasedYear: '2018', rating: 9 },
      { title: 'Wonder Woman', genre: 'Action', type: 'Hollywood', releasedYear: '2017', rating: 8 },
      { title: 'Captain Marvel', genre: 'Action', type: 'Hollywood', releasedYear: '2019', rating: 7 },
      { title: 'Deadpool', genre: 'Action', type: 'Hollywood', releasedYear: '2018', rating: 8 },
      { title: 'Venom', genre: 'Action', type: 'Hollywood', releasedYear: '2018', rating: 9 },
      { title: 'Bahubali', genre: 'Action', type: 'Bollywood', releasedYear: '2017', rating: 10 },
      { title: 'The Ghazi Attack', genre: 'Action', type: 'Bollywood', releasedYear: '2017', rating: 9 },
      { title: 'Point Man', genre: 'Action', type: 'Bollywood', releasedYear: '2018', rating: 8 },
      { title: 'Uri: The Surgical Strike', genre: 'Action', type: 'Bollywood', releasedYear: '2019', rating: 10 },
      { title: 'Hotel Mumbai', genre: 'Action', type: 'Bollywood', releasedYear: '2020', rating: 8 },
      { title: 'Jumanji: Welcome to the Jungle', genre: 'Comedy', type: 'Hollywood', releasedYear: '2017', rating: 8 },
      { title: 'Coco', genre: 'Comedy', type: 'Hollywood', releasedYear: '2017', rating: 9 },
      { title: 'Jojo Rabbit', genre: 'Comedy', type: 'Hollywood', releasedYear: '2019', rating: 7 },
      { title: "Don't Look Up", genre: 'Comedy', type: 'Hollywood', releasedYear: '2021', rating: 9 },
      { title: 'Avengers: Endgame', genre: 'Fantasy', type: 'Hollywood', releasedYear: '2019', rating: 10 },
      { title: 'Harry Potter and the Deathly Hallows ‚Äì Part 2', genre: 'Fantasy', type: 'Hollywood', releasedYear: '2011', rating: 9 },
      { title: 'Shutter Island', genre: 'Thriller', type: 'Hollywood', releasedYear: '2010', rating: 9 },
      { title: 'Joker', genre: 'Thriller', type: 'Hollywood', releasedYear: '2019', rating: 8 },
      { title: 'Andhadhun', genre: 'Thriller', type: 'Bollywood', releasedYear: '2018', rating: 9 }
    ];

    async function getPoster(title) {
      try {
        const url = `https://api.themoviedb.org/3/search/movie?api_key=${TMDB_KEY}&query=${encodeURIComponent(title)}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.results && data.results.length > 0 && data.results[0].poster_path) {
          return `https://image.tmdb.org/t/p/w342${data.results[0].poster_path}`;
        }
      } catch(e) {}
      return 'https://via.placeholder.com/342x513?text=No+Poster';
    }

    async function renderMovies(list, containerId) {
      const box = document.getElementById(containerId);
      box.innerHTML = '';
      for (const m of list) {
        const poster = await getPoster(m.title);
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
          <img src="${poster}" alt="${m.title}">
          <div class="movie-info">
            <h3>${m.title}</h3>
            <span class="badge genre-${m.genre}">${m.genre}</span>
            <span class="badge type-${m.type}">${m.type}</span>
            <span class="badge year">${m.releasedYear}</span>
            <div class="rating">‚≠ê ${m.rating}/10</div>
            <button class="add-history" data-title="${m.title}">Add to History</button>
          </div>
        `;
        box.appendChild(card);
      }
    }

    function getHistoryKey() {
      const user = localStorage.getItem("currentUser");
      return user ? "history_" + user : "screenselect_history";
    }

    function renderHistory() {
      const key = getHistoryKey();
      const history = JSON.parse(localStorage.getItem(key) || '[]');
      const list = MOVIES.filter(m => history.includes(m.title));
      renderMovies(list, 'history-list');
    }

    function renderRecommendations() {
      const key = getHistoryKey();
      const history = JSON.parse(localStorage.getItem(key) || '[]');
      if (history.length === 0) { document.getElementById('reco-list').innerHTML=''; return; }
      const counts = {};
      history.forEach(t => {
        const movie = MOVIES.find(m => m.title === t);
        if (movie) counts[movie.genre] = (counts[movie.genre]||0)+1;
      });
      const topGenre = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0];
      const recos = MOVIES.filter(m=>m.genre===topGenre && !history.includes(m.title));
      renderMovies(recos, 'reco-list');
    }

    document.addEventListener('click', e => {
      if (!e.target.classList.contains('add-history')) return;
      const title = e.target.dataset.title;
      const key = getHistoryKey();
      let h = JSON.parse(localStorage.getItem(key) || '[]');
      if (!h.includes(title)) h.push(title);
      localStorage.setItem(key, JSON.stringify(h));
      renderHistory();
      renderRecommendations();
    });

    function sendFeedback(option) {
      console.log('Feedback:', option);
      alert('Thanks for your feedback: '+option);
    }

    function isStrongPassword(pass) {
      return /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{8,}$/.test(pass);
    }

    function signup() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value;
      if (!user || !pass) return alert("Enter username and password!");
      if (!isStrongPassword(pass)) {
        document.getElementById("password-error").style.display = "block";
        return;
      } else {
        document.getElementById("password-error").style.display = "none";
      }
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      if (users[user]) return alert("User already exists!");
      users[user] = { password: pass };
      localStorage.setItem("users", JSON.stringify(users));
      alert("Signup successful! Please login.");
    }

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value;
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      if (!users[user] || users[user].password !== pass) {
        return alert("Invalid login!");
      }
      localStorage.setItem("currentUser", user);
      showWelcome(user);
      renderHistory();
      renderRecommendations();
      document.getElementById("app").style.display = "block";
    }

    function logout() {
      localStorage.removeItem("currentUser");
      document.getElementById("auth-forms").style.display = "block";
      document.getElementById("welcome").style.display = "none";
      document.getElementById("app").style.display = "none";
    }

    function showWelcome(user) {
      document.getElementById("auth-forms").style.display = "none";
      document.getElementById("welcome").style.display = "block";
      document.getElementById("currentUser").innerText = user;
    }

    // On load, check if user already logged in
    const currentUser = localStorage.getItem("currentUser");
    if (currentUser) {
      showWelcome(currentUser);
      document.getElementById("app").style.display = "block";
    }

    // Initial render
    renderMovies(MOVIES, 'movie-list');
    renderHistory();
    renderRecommendations();
  </script>
</body>
</html>
